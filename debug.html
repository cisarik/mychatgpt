<section class="tab-card" data-tab-root="debug">
  <div class="flex-between">
    <h2>Diagnostics</h2>
    <div>
      <button data-action="scan-now">Scan Now</button>
      <button data-action="force-inject">Force inject content script</button>
      <button data-action="run-probe">Run extractor self-test (active tab)</button>
    </div>
  </div>
  <p class="tab-copy" data-role="inject-status"></p>
  <p class="tab-copy">
    Service worker logs live in chrome://extensions -> MyChatGPT -> "Service worker" -> Inspect.
  </p>
  <div class="flex-between">
    <label>
      Tail level
      <select data-role="log-level-filter">
        <option value="TRACE">TRACE</option>
        <option value="DEBUG">DEBUG</option>
        <option value="INFO" selected>INFO</option>
        <option value="WARN">WARN</option>
        <option value="ERROR">ERROR</option>
      </select>
    </label>
    <div>
      <button class="secondary" data-action="clear-logs">Clear logs</button>
      <button class="secondary" data-action="export-logs">Export JSON</button>
    </div>
  </div>
  <div class="log-list" data-role="log-tail"></div>
  <div class="flex-between">
    <small data-role="last-scan">No scans yet.</small>
  </div>
  <div class="tab-card" data-role="would-report">
    <div class="flex-between">
      <h3>Would-delete report (simulated)</h3>
      <div class="inline-group">
        <button class="secondary" data-action="report-refresh">Refresh report</button>
        <button class="secondary" data-action="report-export">Export CSV</button>
        <button class="secondary" data-action="report-clear">Clear report</button>
        <button data-action="report-scan-all">Scan all open chat tabs now</button>
      </div>
    </div>
    <p class="tab-copy">
      <span data-role="report-total-seen">0</span> tabs scanned •
      <span data-role="report-total-qualified">0</span> qualify • Updated
      <span data-role="report-updated">never</span>
    </p>
    <div class="table-scroll">
      <table class="data-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Last age (min)</th>
            <th>Msgs</th>
            <th>User msgs</th>
            <th>Reasons</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody data-role="report-rows"></tbody>
      </table>
    </div>
  </div>
  <div class="tab-card" data-role="soft-plan">
    <div class="flex-between">
      <h3>Soft-delete DRY-RUN plan</h3>
      <div class="inline-group">
        <button class="secondary" data-action="plan-regenerate">Regenerate plan from current report</button>
        <button class="secondary" data-action="plan-export">Export plan (JSON)</button>
        <button class="secondary" data-action="plan-clear">Clear plan</button>
        <button data-action="plan-confirm">Simulate batch confirm (log-only)</button>
      </div>
    </div>
    <p class="tab-copy">
      Planned: <span data-role="plan-total">0</span> • Generated
      <span data-role="plan-updated">never</span>
    </p>
    <div class="table-scroll">
      <table class="data-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Convo</th>
            <th>Last age (min)</th>
            <th>Msgs</th>
            <th>Reasons</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody data-role="plan-rows"></tbody>
      </table>
    </div>
  </div>
  <div class="tab-card" data-role="live-mode-card">
    <div class="flex-between">
      <h3>Live Mode (real PATCH)</h3>
      <span class="badge" data-role="live-arm-status">SAFE (dry-run)</span>
    </div>
    <p class="tab-copy">
      Live Mode vykoná reálne PATCH iba pri LIST_ONLY=false a DRY_RUN=false a po explicitnom potvrdení. Operácie sú lokálne limitované a logované.
    </p>
    <div class="inline-group">
      <button data-action="live-test">Test page bridge</button>
      <small data-role="live-test-result"></small>
    </div>
    <div class="inline-group">
      <button class="secondary" data-action="live-load-plan">Load from DRY-RUN plan</button>
      <button data-action="live-open-confirm" disabled>Confirm LIVE soft-delete (PATCH)</button>
    </div>
    <div class="table-scroll" data-role="live-selection-container" hidden>
      <table class="data-table">
        <thead>
          <tr>
            <th>Select</th>
            <th>Title</th>
            <th>Convo</th>
            <th>URL</th>
          </tr>
        </thead>
        <tbody data-role="live-selection-rows"></tbody>
      </table>
    </div>
    <div class="tab-card" data-role="live-results-card" hidden>
      <div class="flex-between">
        <strong>Last LIVE batch</strong>
        <button class="secondary" data-action="live-copy-results" disabled>Copy JSON</button>
      </div>
      <ul data-role="live-results-list"></ul>
    </div>
    <div class="tab-card" data-role="endpoint-diagnostics">
      <div class="flex-between">
        <h4>Endpoint diagnostics</h4>
        <button data-action="endpoint-probe">Probe endpoint</button>
      </div>
      <div class="inline-group">
        <input type="text" data-role="endpoint-probe-id" placeholder="Conversation ID" />
        <small data-role="endpoint-probe-status"></small>
      </div>
      <pre data-role="endpoint-probe-output"></pre>
    </div>
    <p class="tab-copy" data-role="live-selection-hint" hidden></p>
    <p class="tab-copy" data-role="live-batch-note" hidden></p>
    <dialog data-role="live-confirm-dialog">
      <form method="dialog" class="modal-body">
        <header class="flex-between">
          <strong>Confirm LIVE soft-delete</strong>
          <button type="submit" value="cancel" class="secondary">Cancel</button>
        </header>
        <p data-role="live-confirm-summary"></p>
        <ul data-role="live-confirm-list"></ul>
        <p data-role="live-confirm-limits"></p>
        <p class="tab-copy" data-role="live-confirm-warning" hidden></p>
        <label>
          <input type="checkbox" data-role="live-confirm-ack" /> I understand this sends real PATCH requests.
        </label>
        <footer class="flex-between">
          <button type="submit" value="cancel" class="secondary">Back</button>
          <button value="confirm" data-action="live-confirm-submit">Send PATCH batch</button>
        </footer>
      </form>
    </dialog>
    <div class="tab-card" data-role="undo-tools" hidden>
      <div class="flex-between">
        <h4>Undo queue</h4>
        <button class="secondary" data-action="undo-open-confirm" disabled>Confirm UNDO (PATCH visible:true)</button>
      </div>
      <p class="tab-copy" data-role="undo-hint"></p>
      <form class="inline-group" data-role="undo-manual-form">
        <input type="text" name="convoId" placeholder="Conversation ID" required />
        <input type="url" name="url" placeholder="Optional URL" />
        <input type="text" name="title" placeholder="Optional title" />
        <button type="submit">Add to queue</button>
      </form>
      <div class="inline-group">
        <button class="secondary" data-action="undo-load-recent">Load recent hidden</button>
        <button class="secondary" data-action="undo-clear-queue">Clear queue</button>
      </div>
      <div class="table-scroll">
        <table class="data-table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Convo</th>
              <th>URL</th>
              <th>Queued</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody data-role="undo-rows"></tbody>
        </table>
      </div>
      <div class="tab-card" data-role="undo-results-card" hidden>
        <div class="flex-between">
          <strong>Last UNDO batch</strong>
          <button class="secondary" data-action="undo-copy-results" disabled>Copy JSON</button>
        </div>
        <ul data-role="undo-results-list"></ul>
      </div>
      <dialog data-role="undo-confirm-dialog">
        <form method="dialog" class="modal-body">
          <header class="flex-between">
            <strong>Confirm UNDO</strong>
            <button type="submit" value="cancel" class="secondary">Cancel</button>
          </header>
          <p data-role="undo-confirm-summary"></p>
          <ul data-role="undo-confirm-list"></ul>
          <p data-role="undo-confirm-limits"></p>
          <p class="tab-copy" data-role="undo-confirm-warning" hidden></p>
          <label>
            <input type="checkbox" data-role="undo-confirm-ack" /> Restore visibility (PATCH visible:true) for selected entries.
          </label>
          <footer class="flex-between">
            <button type="submit" value="cancel" class="secondary">Back</button>
            <button value="confirm" data-action="undo-confirm-submit">Send UNDO batch</button>
          </footer>
        </form>
      </dialog>
    </div>
  </div>
  <div class="tab-card" data-role="audit-card">
    <div class="flex-between">
      <h3>Audit trail</h3>
      <div class="inline-group">
        <button class="secondary" data-action="audit-refresh">Refresh</button>
        <button class="secondary" data-action="audit-clear">Clear</button>
        <button class="secondary" data-action="audit-export-csv">Export CSV</button>
        <button class="secondary" data-action="audit-export-json">Export JSON</button>
      </div>
    </div>
    <div class="inline-group audit-filters">
      <label>
        Tail
        <input type="number" min="1" value="100" data-role="audit-limit" />
      </label>
      <label>
        Operation
        <select data-role="audit-filter-op">
          <option value="">Any</option>
          <option value="hide">hide</option>
          <option value="undo">undo</option>
        </select>
      </label>
      <label>
        Status
        <input type="number" data-role="audit-filter-status" placeholder="Any" />
      </label>
      <label>
        Reason
        <input type="text" data-role="audit-filter-reason" placeholder="Filter by reason code" />
      </label>
    </div>
    <div class="table-scroll">
      <table class="data-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Op</th>
            <th>Convo</th>
            <th>Title</th>
            <th>Status</th>
            <th>OK</th>
            <th>Reason</th>
            <th>Note</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody data-role="audit-rows"></tbody>
      </table>
    </div>
  </div>
  <div class="tab-card" data-role="probe-container">
    <div class="flex-between">
      <h3>Extractor Self-Test</h3>
      <button class="secondary" data-action="copy-probe" disabled>Copy JSON</button>
    </div>
    <pre class="code-block" data-role="probe-output">Run the probe to inspect extractor status.</pre>
  </div>
  <div class="tab-card" data-role="snapshot-container" hidden>
    <details>
      <summary>Last extractor snapshot</summary>
      <pre class="code-block" data-role="snapshot-output"></pre>
    </details>
  </div>
  <dialog data-role="soft-plan-modal">
    <form method="dialog" class="modal-body">
      <header class="flex-between">
        <strong data-role="plan-modal-title">Detail</strong>
        <button type="submit" value="cancel" data-action="plan-modal-close" class="secondary">Close</button>
      </header>
      <pre class="code-block" data-role="plan-modal-content"></pre>
    </form>
  </dialog>
</section>
